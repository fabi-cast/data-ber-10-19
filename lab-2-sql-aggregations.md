{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "![IronHack Logo](https://s3-eu-west-1.amazonaws.com/ih-materials/uploads/upload_d5c5793015fec3be28a63c4fa3dd4d55.png)\n",
    "\n",
    "# Lab | SQL - Aggregation\n",
    "\n",
    "## Introduction\n",
    "\n",
    "In this lab, we are adding the `GROUP BY` clause and aggregations to our SQL vocabulary.\n",
    "\n",
    "Please submit your solutions in a text file `solutions.sql`.\n",
    "\n",
    "## Challenge:\n",
    "\n",
    "Assume that any `_id` columns are incremental, meaning that higher ids always occured after lower ids. For example, a client with a higher `client_id` joined the bank after a client with a lower `client_id`.\n",
    "\n",
    "### 1. From the `client` table, of all districts with a `district_id` lower than 10, how many clients are from each `district_id`? Show the results sorted by district_id in ascending order.\n",
    "Result:\n",
    "```\n",
    "1\t663\t\n",
    "2\t46\t\n",
    "3\t63\t\n",
    "4\t50\t\n",
    "5\t71\t\n",
    "6\t53\t\n",
    "7\t45\t\n",
    "8\t69\t\n",
    "9\t60\n",
    "```\n",
    "\n",
    "### 2. From the `card` table, how many cards exist for each `type`? Rank the result starting with the most frequent `type`.\n",
    "Result:\n",
    "```\n",
    "classic\t659\t\n",
    "junior\t145\t\n",
    "gold\t88\n",
    "```\n",
    "\n",
    "### 3. Using the `loan` table, print the top 10 `account_id`s based on the sum of all of their loan amounts.\n",
    "Result:\n",
    "```\n",
    "7542\t590820\t\n",
    "8926\t566640\t\n",
    "2335\t541200\t\n",
    "817\t538500\t\n",
    "2936\t504000\t\n",
    "7049\t495180\t\n",
    "10451\t482940\t\n",
    "6950\t475680\t\n",
    "7966\t473280\t\n",
    "339\t468060\n",
    "```\n",
    "\n",
    "### 4. From the `loan` table, retrieve the number of loans issued for each day, before (excl) 930907, ordered by date in descending order\n",
    "Result:\n",
    "```\n",
    "930906\t1\t\n",
    "930803\t1\t\n",
    "930728\t1\t\n",
    "930711\t1\t\n",
    "930705\t1\n",
    "```\n",
    "\n",
    "### 5. From the `loan` table, for each day in December 1997, count the number of loans issued for each unique loan duration, ordered by date and duration, both in ascending order. You can ignore days without any loans in your output.\n",
    "Result:\n",
    "```\n",
    "971206\t24\t1\t\n",
    "971206\t36\t1\t\n",
    "971208\t12\t3\t\n",
    "971209\t12\t1\t\n",
    "971209\t24\t1\t\n",
    "971210\t12\t1\t\n",
    "971211\t24\t1\t\n",
    "971211\t48\t1\t\n",
    "971213\t24\t1\t\n",
    "971220\t36\t1\t\n",
    "971221\t36\t1\t\n",
    "971224\t60\t1\t\n",
    "971225\t24\t1\t\n",
    "971225\t60\t1\t\n",
    "```\n",
    "\n",
    "### 6. From the `trans` table, for account_id 396, sum the amount of transactions for each type (VYDAJ = Outgoing, PRIJEM = Incoming). Your output should have the account_id, the type and the sum of amount, named as `total_amount`. Sort alphabetically by type.\n",
    "Result:\n",
    "```\n",
    "396\tPRIJEM\t1028138.6999740601\t\n",
    "396\tVYDAJ\t1485814.400024414\n",
    "```\n",
    "\n",
    "### 7. From the previous output, translate the values for `type` to English, rename the column to `transaction_type`, round `total_amount` down to an integer\n",
    "Result:\n",
    "```\n",
    "396\tINCOMING\t1028138\t\n",
    "396\tOUTGOING\t1485814\n",
    "```\n",
    "\n",
    "### 8. From the previous result, modify you query so that it returns only one row, with a column for incoming amount, outgoing amount and the difference\n",
    "Result:\n",
    "```\n",
    "396\t1028138\t1485814\t-457676\n",
    "```\n",
    "\n",
    "### 9. Continuing with the previous example, rank the top 10 account_ids based on their difference\n",
    "Result:\n",
    "```\n",
    "9707\t869527\t\n",
    "3424\t816372\t\n",
    "3260\t803055\t\n",
    "2486\t735219\t\n",
    "1801\t725382\t\n",
    "4470\t707243\t\n",
    "3674\t703531\t\n",
    "9656\t702786\t\n",
    "2227\t696564\t\n",
    "6473\t692580\n",
    "```\n",
    "\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.7.3"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
